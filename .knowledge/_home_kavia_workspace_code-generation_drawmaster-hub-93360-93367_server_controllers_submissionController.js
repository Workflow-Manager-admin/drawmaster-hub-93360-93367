{"is_source_file": true, "format": "JavaScript (Node.js/Express)", "description": "This file is a controller module for managing submissions in a contest platform. It includes functions for creating, retrieving, updating, deleting, and rating submissions, as well as auxiliary functions such as fetching submissions by contest and updating their status. The code interacts with 'Submission' and 'Contest' models, suggesting it handles core submission-related logic and routes.", "external_files": ["../models/Submission", "../models/Contest"], "external_methods": ["Submission.find", "Submission.findById", "Submission.findOne", "Submission.create", "Submission.findByIdAndUpdate", "Submission.findByIdAndDelete", "submission.deleteOne()", "Contest.findById"], "published": ["getSubmissions", "getSubmission", "createSubmission", "updateSubmission", "deleteSubmission", "getSubmissionsByContest", "updateSubmissionStatus", "rateSubmission"], "classes": [], "methods": [{"name": "getSubmissions", "description": "Retrieves a list of submissions. Admins can filter by user; regular users see only their own submissions. Includes population of related contest data, sorted by submission date."}, {"name": "getSubmission", "description": "Retrieves a specific submission by its ID, including populated user and contest info."}, {"name": "createSubmission", "description": "Creates a new submission after verifying contest existence and activity status, and ensuring the user hasn't already submitted to the contest."}, {"name": "updateSubmission", "description": "Updates details of an existing submission if authorized and if the contest is still active."}, {"name": "deleteSubmission", "description": "Deletes a submission if authorized and if the contest is still active (unless admin)."}, {"name": "getSubmissionsByContest", "description": "Fetches approved submissions for a specific contest."}, {"name": "updateSubmissionStatus", "description": "Allows an admin to set the status of a submission (approved, rejected, pending)."}, {"name": "rateSubmission", "description": "Allows users to rate completed contest submissions, updating the average rating with basic averaging logic."}], "calls": ["Submission.find", "Submission.findById", "Submission.findOne", "Submission.create", "Submission.findByIdAndUpdate", "Submission.findByIdAndDelete", "submission.deleteOne()", "Contest.findById"], "search-terms": ["submissionController", "Submission model", "Contest model", "getSubmissions", "createSubmission", "updateSubmission", "rateSubmission", "submission status", "contest activity state"], "state": 2, "file_id": 33, "knowledge_revision": 68, "git_revision": "d76081dda8d7a52d2f275eef189b29616508245e", "ctags": [{"_type": "tag", "name": "Contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const Contest = require('..\\/models\\/Contest');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "Submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const Submission = require('..\\/models\\/Submission');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const contest = await Contest.findById(req.body.contest);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const contest = await Contest.findById(req.params.contestId);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const contest = await Contest.findById(submission.contest);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^      description: req.body.description,$/", "language": "JavaScript", "kind": "property", "scope": "fieldsToUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "existingSubmission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const existingSubmission = await Submission.findOne({$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "fieldsToUpdate", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const fieldsToUpdate = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "imageUrl", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^      imageUrl: req.body.imageUrl$/", "language": "JavaScript", "kind": "property", "scope": "fieldsToUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "newRatingAvg", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const newRatingAvg = ((submission.rating * submission.reviewCount) + rating) \\/ newRatingCou/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "newRatingCount", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const newRatingCount = submission.reviewCount + 1;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    let query;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "rating", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const rating = parseInt(req.body.rating);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submission = await Submission.create(req.body);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submission = await Submission.findById(req.params.id)$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submission = await Submission.findById(req.params.id);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    let submission = await Submission.findById(req.params.id);$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "submissions", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submissions = await Submission.find({ $/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submissions", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submissions = await query;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^      title: req.body.title,$/", "language": "JavaScript", "kind": "property", "scope": "fieldsToUpdate", "scopeKind": "class"}], "filename": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "hash": "2bdfa04c67f4044e1e200bb2ae7f455c", "format-version": 4, "code-base-name": "default", "fields": [{"name": "description: req.body.description,", "scope": "fieldsToUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "imageUrl: req.body.imageUrl", "scope": "fieldsToUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "let query;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let submission = await Submission.findById(req.params.id);", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "title: req.body.title,", "scope": "fieldsToUpdate", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"68": "d76081dda8d7a52d2f275eef189b29616508245e"}]}