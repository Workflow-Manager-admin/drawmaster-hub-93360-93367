{"is_source_file": true, "format": "JavaScript", "description": "This file contains controller functions for managing submissions in a contest platform, including CRUD operations, status updates, rating, and file uploads using multer.", "external_files": ["../models/Submission", "../models/Contest", "multer", "path", "fs"], "external_methods": ["Submission.find", "Submission.findById", "Submission.findOne", "Submission.create", "Submission.findByIdAndUpdate", "Submission.deleteOne", "Contest.findById"], "published": ["exports.getSubmissions", "exports.getSubmission", "exports.createSubmission", "exports.updateSubmission", "exports.deleteSubmission", "exports.getSubmissionsByContest", "exports.updateSubmissionStatus", "exports.rateSubmission"], "classes": [], "methods": [{"name": "getSubmissions", "description": "Fetches all submissions, filtered by user role and query parameters, with related contest info."}, {"name": "getSubmission", "description": "Fetches a single submission by ID, populating user and contest data."}, {"name": "createSubmission", "description": "Handles creation of a new submission, including file upload, contest validation, and duplicate checks."}, {"name": "updateSubmission", "description": "Allows updating of a submission's details and image, with proper authorization and file replacement."}, {"name": "deleteSubmission", "description": "Deletes a submission if authorized and contest is active or admin."}, {"name": "getSubmissionsByContest", "description": "Retrieves approved submissions for a specific contest."}, {"name": "updateSubmissionStatus", "description": "Allows an admin to approve, reject, or set submissions as pending."}, {"name": "rateSubmission", "description": "Allows users to rate submissions after contest completion, updates average rating."}, {"name": "AnonymousFunctionc91301cf0100(req, file, cb)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "AnonymousFunctionc91301cf0200(req, file, cb)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "AnonymousFunctionc91301cf0300(err)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "AnonymousFunctionc91301cf0400(err)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["Submission.find", "Submission.findById", "Submission.findOne", "Submission.create", "Submission.findByIdAndUpdate", "Submission.deleteOne", "Contest.findById"], "search-terms": ["submissionController", "multer disk storage", "getSubmissions", "createSubmission", "updateSubmission", "rateSubmission", "approval status", "file upload handling", "contest validation", "submission rating"], "state": 2, "file_id": 33, "knowledge_revision": 176, "git_revision": "b8d45def799bd92aedf5e657b2247ce5d1d02ca1", "revision_history": [{"68": "d76081dda8d7a52d2f275eef189b29616508245e"}, {"174": "68c1734f6d76666d93ad24e789f125ae498b57b8"}, {"175": "6d1343e41600b36e0a5d474f5afee96fb811b78a"}, {"176": "b8d45def799bd92aedf5e657b2247ce5d1d02ca1"}], "ctags": [{"_type": "tag", "name": "AnonymousFunctionc91301cf0100", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^  destination: function(req, file, cb) {$/", "language": "JavaScript", "kind": "function", "signature": "(req, file, cb)"}, {"_type": "tag", "name": "AnonymousFunctionc91301cf0200", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^  filename: function(req, file, cb) {$/", "language": "JavaScript", "kind": "function", "signature": "(req, file, cb)"}, {"_type": "tag", "name": "AnonymousFunctionc91301cf0300", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^  upload(req, res, async function(err) {$/", "language": "JavaScript", "kind": "function", "signature": "(err)"}, {"_type": "tag", "name": "AnonymousFunctionc91301cf0400", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^  upload(req, res, async function(err) {$/", "language": "JavaScript", "kind": "function", "signature": "(err)"}, {"_type": "tag", "name": "Contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const Contest = require('..\\/models\\/Contest');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "Submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const Submission = require('..\\/models\\/Submission');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^        contest: req.body.contest,$/", "language": "JavaScript", "kind": "property", "scope": "AnonymousFunctionc91301cf0300.submissionData", "scopeKind": "class"}, {"_type": "tag", "name": "contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const contest = await Contest.findById(req.params.contestId);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const contest = await Contest.findById(submission.contest);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^        description: req.body.description,$/", "language": "JavaScript", "kind": "property", "scope": "AnonymousFunctionc91301cf0300.submissionData", "scopeKind": "class"}, {"_type": "tag", "name": "fileFilter", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const fileFilter = (req, file, cb) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "fs", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const fs = require('fs');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "imageUrl", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^        imageUrl: imageUrl$/", "language": "JavaScript", "kind": "property", "scope": "AnonymousFunctionc91301cf0300.submissionData", "scopeKind": "class"}, {"_type": "tag", "name": "multer", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const multer = require('multer');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "newRatingAvg", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const newRatingAvg = ((submission.rating * submission.reviewCount) + rating) \\/ newRatingCou/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "newRatingCount", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const newRatingCount = submission.reviewCount + 1;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const path = require('path');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    let query;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "rating", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const rating = parseInt(req.body.rating);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "storage", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const storage = multer.diskStorage({$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submission = await Submission.findById(req.params.id)$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submission = await Submission.findById(req.params.id);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    let submission = await Submission.findById(req.params.id);$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "submissionData", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^      const submissionData = {$/", "language": "JavaScript", "kind": "class", "scope": "AnonymousFunctionc91301cf0300", "scopeKind": "class"}, {"_type": "tag", "name": "submissions", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submissions = await Submission.find({ $/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submissions", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submissions = await query;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^        title: req.body.title,$/", "language": "JavaScript", "kind": "property", "scope": "AnonymousFunctionc91301cf0300.submissionData", "scopeKind": "class"}, {"_type": "tag", "name": "upload", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const upload = multer({ $/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^        user: req.user.id,$/", "language": "JavaScript", "kind": "property", "scope": "AnonymousFunctionc91301cf0300.submissionData", "scopeKind": "class"}], "filename": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "hash": "72ba7cea0fec615179d78d4883dc0621", "format-version": 4, "code-base-name": "default", "fields": [{"name": "contest: req.body.contest,", "scope": "AnonymousFunctionc91301cf0300.submissionData", "scopeKind": "class", "description": "unavailable"}, {"name": "description: req.body.description,", "scope": "AnonymousFunctionc91301cf0300.submissionData", "scopeKind": "class", "description": "unavailable"}, {"name": "imageUrl: imageUrl", "scope": "AnonymousFunctionc91301cf0300.submissionData", "scopeKind": "class", "description": "unavailable"}, {"name": "let query;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let submission = await Submission.findById(req.params.id);", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "title: req.body.title,", "scope": "AnonymousFunctionc91301cf0300.submissionData", "scopeKind": "class", "description": "unavailable"}, {"name": "user: req.user.id,", "scope": "AnonymousFunctionc91301cf0300.submissionData", "scopeKind": "class", "description": "unavailable"}]}