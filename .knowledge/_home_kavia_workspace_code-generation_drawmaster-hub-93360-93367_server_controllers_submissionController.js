{"is_source_file": true, "format": "JavaScript", "description": "This file is a controller module for handling submission-related API endpoints in a Node.js/Express application. It includes functions for CRUD operations on submission data, interacting with 'Submission' and 'Contest' models, and supports features like file uploads, status updates, and rating submissions. The functions define internal logic for validation, authorization, and database interactions.", "external_files": ["../models/Submission", "../models/Contest"], "external_methods": ["Submission.find", "Submission.findById", "Submission.create", "Submission.findOne", "Submission.findByIdAndUpdate", "Submission.findByIdAndDelete", "Submission.prototype.deleteOne", "Contest.findById"], "published": ["getSubmissions", "getSubmission", "createSubmission", "updateSubmission", "deleteSubmission", "getSubmissionsByContest", "updateSubmissionStatus", "rateSubmission"], "classes": [], "methods": [{"name": "getSubmissions", "description": "Retrieves submissions, with filtering based on user role and query parameters, including population and sorting."}, {"name": "getSubmission", "description": "Fetches a single submission by ID, including populated user and contest data."}, {"name": "createSubmission", "description": "Creates a new submission after validating contest existence and status, and checking for duplicate submissions by the same user."}, {"name": "updateSubmission", "description": "Updates an existing submission if the user is authorized and the contest is active."}, {"name": "deleteSubmission", "description": "Deletes a submission if authorized and the contest is still active or the user is an admin."}, {"name": "getSubmissionsByContest", "description": "Fetches approved submissions associated with a specific contest."}, {"name": "updateSubmissionStatus", "description": "Allows admins to update the status of a submission (approve/reject/pending)."}, {"name": "rateSubmission", "description": "Allows users to rate a submission after contest completion, updating average rating and review count."}, {"name": "AnonymousFunctionc91301cf0100(req, file, cb)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "AnonymousFunctionc91301cf0200(req, file, cb)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["Submission.find", "Submission.findById", "Submission.create", "Submission.findOne", "Submission.findByIdAndUpdate", "Submission.findByIdAndDelete", "Contest.findById"], "search-terms": ["submissionController", "Submission model", "Contest model", "file upload multer", "submission status update", "rate submission", "get all submissions", "get submission by ID", "create submission", "update submission", "delete submission", "submissions by contest", "admin approval", "rating submissions"], "state": 2, "file_id": 33, "knowledge_revision": 174, "git_revision": "68c1734f6d76666d93ad24e789f125ae498b57b8", "revision_history": [{"68": "d76081dda8d7a52d2f275eef189b29616508245e"}, {"174": "68c1734f6d76666d93ad24e789f125ae498b57b8"}], "ctags": [{"_type": "tag", "name": "AnonymousFunctionc91301cf0100", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^  destination: function(req, file, cb) {$/", "language": "JavaScript", "kind": "function", "signature": "(req, file, cb)"}, {"_type": "tag", "name": "AnonymousFunctionc91301cf0200", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^  filename: function(req, file, cb) {$/", "language": "JavaScript", "kind": "function", "signature": "(req, file, cb)"}, {"_type": "tag", "name": "Contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const Contest = require('..\\/models\\/Contest');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "Submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const Submission = require('..\\/models\\/Submission');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const contest = await Contest.findById(req.body.contest);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const contest = await Contest.findById(req.params.contestId);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "contest", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const contest = await Contest.findById(submission.contest);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "description", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^      description: req.body.description,$/", "language": "JavaScript", "kind": "property", "scope": "fieldsToUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "existingSubmission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const existingSubmission = await Submission.findOne({$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "fieldsToUpdate", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const fieldsToUpdate = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "fileFilter", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const fileFilter = (req, file, cb) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "fs", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const fs = require('fs');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "imageUrl", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^      imageUrl: req.body.imageUrl$/", "language": "JavaScript", "kind": "property", "scope": "fieldsToUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "multer", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const multer = require('multer');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "newRatingAvg", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const newRatingAvg = ((submission.rating * submission.reviewCount) + rating) \\/ newRatingCou/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "newRatingCount", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const newRatingCount = submission.reviewCount + 1;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const path = require('path');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    let query;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "rating", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const rating = parseInt(req.body.rating);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "storage", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const storage = multer.diskStorage({$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submission = await Submission.create(req.body);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submission = await Submission.findById(req.params.id)$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submission = await Submission.findById(req.params.id);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submission", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    let submission = await Submission.findById(req.params.id);$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "submissions", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submissions = await Submission.find({ $/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "submissions", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^    const submissions = await query;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^      title: req.body.title,$/", "language": "JavaScript", "kind": "property", "scope": "fieldsToUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "upload", "path": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "pattern": "/^const upload = multer({ $/", "language": "JavaScript", "kind": "constant"}], "filename": "/home/kavia/workspace/code-generation/drawmaster-hub-93360-93367/server/controllers/submissionController.js", "hash": "72c5c7405f94339bd4a16a3375a9d7dd", "format-version": 4, "code-base-name": "default", "fields": [{"name": "description: req.body.description,", "scope": "fieldsToUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "imageUrl: req.body.imageUrl", "scope": "fieldsToUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "let query;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let submission = await Submission.findById(req.params.id);", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "title: req.body.title,", "scope": "fieldsToUpdate", "scopeKind": "class", "description": "unavailable"}]}